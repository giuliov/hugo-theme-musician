{{- if .Site.IsMultiLingual -}}
  {{- $currentPage := .  -}}{{/* build a map from langCode->translationForCurrentPage */}}
  {{- $cpt := dict -}}
  {{- range $currentPage.Translations -}}
  {{- $cpt = merge $cpt (dict .Language.Lang .) -}}
  {{- end -}}
  {{- range site.Home.AllTranslations -}}
    {{- $sameLanguage := eq $currentPage.Language.Lang .Language.Lang }}
    <li class="nav-item{{ if $sameLanguage }} active{{ end }}">
      {{ $flag := partial "helpers/get-flag-for-country.htm" .Language -}}
      {{ $name := partial "helpers/get-name-for-language.htm" .Language -}}
      {{- if $sameLanguage -}}
        <a class="nav-link fi fi-{{ $flag }}" href="{{ $currentPage.Permalink }}" aria-label='{{ i18n "current-language" }}{{ $name }}'></a>
      {{- else -}}{{/* pick the page translation matching outer loop */}}
        {{- $t := index $cpt .Language.Lang -}}
        <a class="nav-link fi fi-{{ $flag }}" href="{{ $t.Permalink }}" aria-label='{{ i18n "change-language" }}{{ $name }}'></a>
      {{- end }}
    </li>
  {{- end }}
{{- end -}}
